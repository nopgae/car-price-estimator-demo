<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Price Estimator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            display: none;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        .loading {
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Car Price Estimator</h1>
        
        <div class="form-group">
            <label for="brand">Car Brand:</label>
            <select id="brand">
                <option value="">-- Select Brand --</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="model">Car Model:</label>
            <select id="model">
                <option value="">-- Select Model --</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="year">Year:</label>
            <input type="number" id="year" min="1950" max="2025">
        </div>
        
        <div class="form-group">
            <label for="mileage">Mileage:</label>
            <input type="text" id="mileage" placeholder="e.g. 50,000">
        </div>
        
        <div class="form-group">
            <label for="accident">Accident History:</label>
            <select id="accident">
                <option value="no">No accidents</option>
                <option value="yes">Has accident history</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="cleanTitle">Clean Title:</label>
            <select id="cleanTitle">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        
        <button id="estimateBtn">Estimate Price</button>
        
        <div class="loading" id="loading">
            Calculating estimate...
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="result" id="result">
            <h2>Estimated Price: <span id="estimatedPrice">$0</span></h2>
            <p>Based on <span id="similarCars">0</span> similar vehicles</p>
            <p>Price Range: <span id="minPrice">$0</span> - <span id="maxPrice">$0</span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load car brands on page load
            fetch('/api/brands')
                .then(response => response.json())
                .then(brands => {
                    const brandSelect = document.getElementById('brand');
                    brands.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand;
                        option.textContent = brand;
                        brandSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading brands:', error);
                    document.getElementById('error').textContent = 'Failed to load car brands.';
                });
            
            // Load models when brand changes
            document.getElementById('brand').addEventListener('change', function() {
                const brand = this.value;
                const modelSelect = document.getElementById('model');
                
                // Clear existing options
                modelSelect.innerHTML = '<option value="">-- Select Model --</option>';
                
                if (brand) {
                    fetch(`/api/models/${brand}`)
                        .then(response => response.json())
                        .then(models => {
                            models.forEach(model => {
                                const option = document.createElement('option');
                                option.value = model;
                                option.textContent = model;
                                modelSelect.appendChild(option);
                            });
                        })
                        .catch(error => {
                            console.error('Error loading models:', error);
                            document.getElementById('error').textContent = 'Failed to load car models.';
                        });
                }
            });
            
            // Handle estimate button click
            document.getElementById('estimateBtn').addEventListener('click', function() {
                const brand = document.getElementById('brand').value;
                const model = document.getElementById('model').value;
                const year = document.getElementById('year').value;
                const mileage = document.getElementById('mileage').value;
                const accident = document.getElementById('accident').value;
                const cleanTitle = document.getElementById('cleanTitle').value;
                
                // Validate inputs
                if (!brand || !model || !year) {
                    document.getElementById('error').textContent = 'Please fill in all required fields (brand, model, year).';
                    return;
                }
                
                // Clear previous results and errors
                document.getElementById('error').textContent = '';
                document.getElementById('result').style.display = 'none';
                document.getElementById('loading').style.display = 'block';
                
                // Send estimate request
                fetch('/api/estimate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        brand,
                        model,
                        year,
                        mileage,
                        accident,
                        cleanTitle
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Failed to estimate price');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('estimatedPrice').textContent = '$' + data.estimatedPrice.toLocaleString();
                    document.getElementById('similarCars').textContent = data.similarCars;
                    document.getElementById('minPrice').textContent = '$' + data.priceRange.min.toLocaleString();
                    document.getElementById('maxPrice').textContent = '$' + data.priceRange.max.toLocaleString();
                    document.getElementById('result').style.display = 'block';
                })
                .catch(error => {
                    document.getElementById('error').textContent = error.message;
                })
                .finally(() => {
                    document.getElementById('loading').style.display = 'none';
                });
            });
            
            // Auto-populate year dropdown with range from 1990 to current year
            const yearInput = document.getElementById('year');
            const currentYear = new Date().getFullYear();
            yearInput.max = currentYear;
            yearInput.value = currentYear - 3; // Default to 3 years old
        });
    </script>
</body>
</html>